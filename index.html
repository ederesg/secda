<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário - Necessidades de Compra</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Configurações da Google Sheets API
        const SHEET_ID = '1ai9Dmp4j_nDhYzdXT7OArLc6vOWCS6332nT77MIifto';
        const SHEET_NAME = 'PTA';
        const API_KEY = '114GMEx9WUkl_GC0sGZwCFSaTkJfmHgm2Am0wtD618Fz65Y_ei2nWthNI'; // Sua chave da API

        // Função para enviar os dados do formulário
        function submitForm(data) {
            const params = {
                spreadsheetId: SHEET_ID,
                range: `${SHEET_NAME}!A2:J`, // Ajuste o range conforme necessário
                valueInputOption: 'RAW',
                insertDataOption: 'INSERT_ROWS',
                key: API_KEY
            };

            const body = {
                values: [data] // Os dados do formulário
            };

            const request = gapi.client.sheets.spreadsheets.values.append(params, body);
            request.then(
                (response) => {
                    console.log('Dados enviados com sucesso:', response);
                    alert('Formulário enviado com sucesso!');
                },
                (error) => {
                    console.error('Erro ao enviar dados:', error);
                    alert('Erro ao enviar formulário.');
                }
            );
        }

        // Inicia a API quando o documento estiver carregado
        function initClient() {
            gapi.client
                .init({
                    apiKey: API_KEY,
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                })
                .then(() => {
                    // API está pronta
                });
        }

        // Carrega a biblioteca
        function loadGapiClient() {
            gapi.load('client', initClient);
        }

        // Chama a função ao enviar o formulário
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("purchase-form").addEventListener("submit", function(event) {
                event.preventDefault(); // Impede o envio padrão do formulário
                loadGapiClient(); // Carrega a API

                // Coleta os dados do formulário
                const data = [
                    document.getElementById("prioridade").value,
                    document.getElementById("item").value,
                    document.getElementById("descricao").value,
                    document.getElementById("quantidade").value,
                    document.getElementById("valor").value,
                    document.getElementById("natureza").value,
                    document.getElementById("secao_centralizador").value,
                    document.getElementById("email_centralizador").value,
                    document.getElementById("secao_cliente").value,
                    document.getElementById("email_cliente").value,
                    document.getElementById("justificativa").value,
                    document.getElementById("status").value,
                ];

                // Envia os dados para a planilha
                submitForm(data);
            });

            document.getElementById("logout").addEventListener("click", function() {
                sessionStorage.clear();
                window.location.href = "login.html";
            });
        });
    </script>
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header text-center">
                <h2>Registro de Necessidades de Compra</h2>
            </div>
            <div class="card-body">
                <form id="purchase-form">
                    <div class="form-group">
                        <label for="prioridade">Prioridade</label>
                        <select class="form-control" id="prioridade" name="prioridade" required>
                            <option value="alta">Alta</option>
                            <option value="media">Média</option>
                            <option value="baixa">Baixa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item">Item/Material</label>
                        <input type="text" class="form-control" id="item" name="item" required>
                    </div>
                    <div class="form-group">
                        <label for="descricao">Descrição</label>
                        <input type="text" class="form-control" id="descricao" name="descricao">
                    </div>
                    <div class="form-group">
                        <label for="quantidade">Quantidade</label>
                        <input type="number" class="form-control" id="quantidade" name="quantidade" required>
                    </div>
                    <div class="form-group">
                        <label for="valor">Valor Estimado</label>
                        <input type="number" class="form-control" id="valor" name="valor" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="natureza">Natureza</label>
                        <input type="text" class="form-control" id="natureza" name="natureza">
                    </div>
                    <div class="form-group">
                        <label for="secao_centralizador">Seção do Centralizador</label>
                        <input type="text" class="form-control" id="secao_centralizador" name="secao_centralizador">
                    </div>
                    <div class="form-group">
                        <label for="email_centralizador">E-mail ZIMBRA do Centralizador</label>
                        <input type="email" class="form-control" id="email_centralizador" name="email_centralizador">
                    </div>
                    <div class="form-group">
                        <label for="secao_cliente">Seção do Cliente (quando houver)</label>
                        <input type="text" class="form-control" id="secao_cliente" name="secao_cliente">
                    </div>
                    <div class="form-group">
                        <label for="email_cliente">E-mail ZIMBRA do Cliente (quando houver)</label>
                        <input type="email" class="form-control" id="email_cliente" name="email_cliente">
                    </div>
                    <div class="form-group">
                        <label for="justificativa">Justificativa Resumida</label>
                        <textarea class="form-control" id="justificativa" name="justificativa" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="status">Status do Processo</label>
                        <input type="text" class="form-control" id="status" name="status">
                    </div>
                    <button type="submit" class="btn btn-success btn-block">Enviar</button>
                </form>
                <button id="logout" class="btn btn-danger btn-block mt-3">Sair</button>
            </div>
        </div>
    </div>
</body>
</html>
